<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Class Routine Generator (HTML/CSS/JS Only)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --primary:#4f46e5;
      --primary-600:#4338ca;
      --primary-700:#3730a3;
      --accent:#22c55e;
      --danger:#ef4444;
      --border:#e2e8f0;
      --shadow: 0 10px 25px rgba(2,6,23,0.06);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:linear-gradient(180deg, #f7f9ff, #eef2ff 50%, #f6f8fb);
      min-height:100vh;
    }
    .container{
      max-width:1100px;
      margin: 32px auto 80px;
      padding: 0 18px;
    }
    header{
      text-align:center;
      margin-bottom: 18px;
    }
    h1{
      font-size: clamp(24px, 3vw, 34px);
      margin:0 0 8px;
      letter-spacing:.2px;
    }
    .subtitle{
      color:var(--muted);
      font-size: 14px;
      margin: 0 auto 14px;
      max-width: 70ch;
    }
    /* Card */
    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    /* Accordion */
    .day-section{ border-bottom:1px solid var(--border); background:var(--card); }
    .day-section:last-child{ border-bottom:0; }

    .accordion-btn{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:18px 20px;
      background:transparent;
      border:0;
      cursor:pointer;
      font-size:16px;
      font-weight:600;
      color:var(--text);
    }
    .accordion-btn:hover{ background:#fafafa; }
    .day-label{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .day-dot{
      width:10px; height:10px; border-radius:100vmax; background:var(--primary);
      box-shadow: 0 0 0 3px rgba(79,70,229,.12);
    }
    .chevron{
      width: 20px; height: 20px; position:relative; flex:0 0 auto;
    }
    .chevron:before, .chevron:after{
      content:"";
      position:absolute;
      width:10px; height:2px; background:#475569;
      top:9px; left:5px;
      transition: transform .25s ease;
    }
    .chevron:before{ transform: rotate(45deg); }
    .chevron:after{ transform: rotate(-45deg); }
    .accordion-btn[aria-expanded="true"] .chevron:before{ transform: rotate(-45deg); }
    .accordion-btn[aria-expanded="true"] .chevron:after{ transform: rotate(45deg); }

    .panel{
      max-height:0;
      overflow:hidden;
      transition:max-height .35s ease;
      background:linear-gradient(180deg,#fff, #fbfdff);
      border-top:1px dashed var(--border);
    }
    .panel-inner{
      padding:16px 20px 22px;
      display:grid;
      gap:16px;
    }

    /* Off day toggle */
    .top-controls{
      display:flex;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:12px;
    }
    .toggle{
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      color:#0f172a;
      font-weight:600;
    }
    .toggle input{ position:absolute; opacity:0; pointer-events:none; }
    .toggle .slider{
      width:46px; height:26px; border-radius:100vmax;
      background:#e5e7eb;
      position:relative;
      transition:background .25s ease;
      box-shadow: inset 0 0 0 1px #d1d5db;
    }
    .toggle .slider::after{
      content:"";
      position:absolute; top:3px; left:3px;
      width:20px; height:20px; border-radius:50%;
      background:white;
      box-shadow: 0 2px 6px rgba(0,0,0,.12);
      transition: transform .25s ease;
    }
    .toggle input:checked + .slider{ background: #22c55e; box-shadow: inset 0 0 0 1px #16a34a; }
    .toggle input:checked + .slider::after{ transform: translateX(20px); }
    .toggle .label{ color:var(--muted); font-weight:500; }

    .offday-note{
      font-size:14px; color:#0f172a;
      background:#ecfdf5; border:1px solid #d1fae5; padding:10px 12px;
      border-radius:10px;
    }

    /* Course card */
    .courses{ display:grid; gap:14px; }
    .course-card{
      position:relative;
      border:1px solid var(--border);
      border-radius:12px;
      padding:14px;
      background:#fff;
    }
    .course-title{
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:10px; gap:10px;
      color:#111827; font-weight:600; font-size:14px;
    }
    .remove-course{
      border:0; background:#fee2e2; color:#b91c1c;
      font-weight:600; padding:6px 10px; border-radius:8px; cursor:pointer;
    }
    .remove-course:hover{ background:#fecaca; }
    .course-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap:12px;
    }
    .field label{
      display:block; font-size:12px; color:#475569; margin-bottom:6px; font-weight:600;
    }
    .field input{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:8px;
      outline:none;
      background:#fff;
      transition: border-color .2s, box-shadow .2s;
    }
    .field input:focus{
      border-color: #a5b4fc;
      box-shadow: 0 0 0 4px rgba(99,102,241,.12);
    }

    .add-course{
      align-self:start;
      width:max-content;
      display:inline-flex; align-items:center; gap:8px;
      border:1px dashed #cbd5e1; color:var(--primary);
      background:#eef2ff; padding:10px 12px; border-radius:10px; cursor:pointer;
      font-weight:700;
    }
    .add-course:disabled{ opacity:.55; cursor:not-allowed; }

    /* Actions */
    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      padding: 16px; background: #fff; border-radius: 0 0 var(--radius) var(--radius);
      border-top:1px solid var(--border);
    }
    .btn{
      appearance:none; border:0; cursor:pointer;
      border-radius:10px; padding:12px 16px; font-weight:700; font-size:14px;
      display:inline-flex; align-items:center; gap:8px;
      transition: transform .02s ease, background .2s ease, box-shadow .2s ease, color .2s ease;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ background:var(--primary); color:#fff; box-shadow: 0 6px 16px rgba(79,70,229,.24); }
    .btn.primary:hover{ background:var(--primary-600); }
    .btn.secondary{ background:#ecfeff; color:#0e7490; border:1px solid #a5f3fc; }
    .btn.secondary:hover{ background:#cffafe; }
    .btn.ghost{ background:#f8fafc; color:#0f172a; border:1px solid var(--border); }
    .btn.ghost:hover{ background:#f1f5f9; }

    .btn[disabled]{ opacity:.55; cursor:not-allowed; }

    /* Progress + status */
    .progress-wrap{
      margin:18px 0 8px;
      background:#f1f5f9;
      border:1px solid var(--border);
      border-radius: 10px;
      overflow:hidden;
      height:12px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
    }
    .progress{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, #60a5fa, #7c3aed, #22c55e);
      background-size: 200% 100%;
      animation: shimmer 1.1s linear infinite;
    }
    @keyframes shimmer{
      0%{ background-position: 0% 50%; }
      100%{ background-position: 200% 50%; }
    }
    .status{
      margin: 6px 0 0;
      display:inline-flex; align-items:center; gap:8px;
      font-weight:700; color:#16a34a;
      padding:8px 12px; border-radius:10px; background:#ecfdf5; border:1px solid #bbf7d0;
    }
    .status .dot{ width:10px; height:10px; background:#16a34a; border-radius:100vmax; box-shadow:0 0 0 3px rgba(22,163,74,.2); }

    /* Output */
    .output{
      margin-top: 18px;
      background:#fff; border:1px solid var(--border); border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .output .head{
      padding:14px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid var(--border);
    }
    .output .head h2{ margin:0; font-size:18px; }
    .table-wrap{
      overflow:auto;
    }
    table{
      width:100%;
      border-collapse:collapse;
      min-width: 760px;
    }
    thead th{
      position:sticky; top:0;
      background:#f8fafc; color:#0f172a;
      font-size:13px; text-transform:uppercase; letter-spacing:.04em;
      padding:12px 10px; border-bottom:1px solid var(--border); z-index:5;
    }
    tbody td{
      padding:12px 10px; border-bottom:1px solid #eef2f7; vertical-align:top;
      font-size:14px;
    }
    tbody tr:nth-child(even){ background:#fcfdff; }
    td.day-cell{
      font-weight:800; color:#111827; background:#f8fafc; border-right:1px solid #eef2f7;
      width:110px;
    }
    td.offday{
      color:#065f46; background:#ecfdf5; font-weight:700;
    }
    td.empty{
      color:#6b7280; font-style:italic;
    }

    /* PDF-friendly adjustments (applied temporarily during export) */
    .for-pdf{ background:#fff !important; border:0 !important; }
    .for-pdf .head{ border:0 !important; }
    .for-pdf thead th{ position:static !important; background:#fff !important; box-shadow:none !important; }
    .for-pdf, .for-pdf *{ box-shadow:none !important; }

    /* Helper small text */
    .muted{
      color:#64748b; font-size:12px;
    }

    @media (max-width:640px){
      .actions{ padding:12px; }
      .btn{ width:100%; justify-content:center; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Class Routine Generator</h1>
      <p class="subtitle">Create your routine for Saturday–Thursday. Add courses per day, mark Off Days, then generate and download your routine as a PDF.</p>
    </header>
v2-----
    <section class="card" id="builderCard">
      <div id="daysContainer"></div>

      <div class="actions">
        <button class="btn primary" id="makeRoutine">
          ⚙️ Make Routine
        </button>
        <button class="btn ghost" id="resetAll">
          ♻️ Reset
        </button>
        <button class="btn secondary" id="downloadPdf" disabled>
          ⬇️ Download as PDF
        </button>
      </div>
    </section>

    <div id="progressWrap" class="progress-wrap" hidden>
      <div class="progress" id="progressBar"></div>
    </div>
    <div id="statusMsg" class="status" hidden>
      <span class="dot"></span> Routine generated
    </div>

    <section class="output" id="routineOutput" hidden>
      <div class="head">
        <h2>Your Routine</h2>
        <div class="muted" id="generatedInfo"></div>
      </div>
      <div class="table-wrap" id="routineTableWrap">
        <!-- table injects here -->
      </div>
    </section>
  </div>

  <!-- html2pdf (bundled with html2canvas + jsPDF) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
          integrity="sha512-YcsIPGdhQ9BesANv5b5GSC5lJt5w8fDGnY5aZgNnq5O8fWfrwS3D2l0anO0gty0G6t0Qm9U0qY8C5D7idimCwQ=="
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    const DAYS = ["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday"];

    const daysContainer = document.getElementById('daysContainer');
    const makeBtn = document.getElementById('makeRoutine');
    const resetBtn = document.getElementById('resetAll');
    const pdfBtn = document.getElementById('downloadPdf');
    const progressWrap = document.getElementById('progressWrap');
    const progressBar = document.getElementById('progressBar');
    const statusMsg = document.getElementById('statusMsg');
    const routineOutput = document.getElementById('routineOutput');
    const routineTableWrap = document.getElementById('routineTableWrap');
    const generatedInfo = document.getElementById('generatedInfo');

    // Build day accordions
    function buildDaySection(day){
      const section = document.createElement('section');
      section.className = 'day-section';
      section.dataset.day = day;

      const headerBtn = document.createElement('button');
      headerBtn.className = 'accordion-btn';
      headerBtn.type = 'button';
      headerBtn.setAttribute('aria-expanded','false');
      headerBtn.innerHTML = `
        <span class="day-label">
          <span class="day-dot" aria-hidden="true"></span>
          ${day}
        </span>
        <span class="chevron" aria-hidden="true"></span>
      `;

      const panel = document.createElement('div');
      panel.className = 'panel';

      const inner = document.createElement('div');
      inner.className = 'panel-inner';

      // Top controls: Off day + "Add Course"
      const top = document.createElement('div');
      top.className = 'top-controls';

      const toggle = document.createElement('label');
      toggle.className = 'toggle';
      toggle.innerHTML = `
        <input type="checkbox" class="offday-input"/>
        <span class="slider" aria-hidden="true"></span>
        <span class="label">Off Day</span>
      `;

      const addBtn = document.createElement('button');
      addBtn.className = 'add-course';
      addBtn.type = 'button';
      addBtn.innerHTML = `➕ Add Course`;

      top.append(toggle, addBtn);

      const offNote = document.createElement('div');
      offNote.className = 'offday-note';
      offNote.textContent = 'Marked as Off Day — no classes.';
      offNote.hidden = true;

      const courses = document.createElement('div');
      courses.className = 'courses';

      inner.append(top, offNote, courses);
      panel.appendChild(inner);

      // Toggle accordion
      headerBtn.addEventListener('click', () => toggleAccordion(panel, headerBtn));

      // Off day behavior
      const offChk = toggle.querySelector('input.offday-input');
      offChk.addEventListener('change', () => {
        if(offChk.checked){
          addBtn.disabled = true;
          courses.style.display = 'none';
          offNote.hidden = false;
        }else{
          addBtn.disabled = false;
          courses.style.display = 'grid';
          offNote.hidden = true;
        }
        autoSizePanel(panel);
      });

      // Add course
      addBtn.addEventListener('click', () => {
        courses.appendChild(createCourseCard(courses.childElementCount+1));
        openIfClosed(headerBtn, panel);
        autoSizePanel(panel);
      });

      section.append(headerBtn, panel);
      return section;
    }

    function toggleAccordion(panel, btn){
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      if(expanded){
        btn.setAttribute('aria-expanded','false');
        panel.style.maxHeight = '0px';
      }else{
        btn.setAttribute('aria-expanded','true');
        panel.style.maxHeight = panel.scrollHeight + 'px';
      }
    }
    function openIfClosed(btn, panel){
      if(btn.getAttribute('aria-expanded') !== 'true'){
        btn.setAttribute('aria-expanded','true');
        panel.style.maxHeight = panel.scrollHeight + 'px';
      }
    }
    function autoSizePanel(panel){
      requestAnimationFrame(()=> {
        panel.style.maxHeight = panel.scrollHeight + 'px';
      });
    }

    function createCourseCard(idx){
      const card = document.createElement('div');
      card.className = 'course-card';

      const title = document.createElement('div');
      title.className = 'course-title';
      title.innerHTML = `<span>Course ${idx}</span>`;
      const remove = document.createElement('button');
      remove.className = 'remove-course';
      remove.type = 'button';
      remove.textContent = 'Remove';
      remove.addEventListener('click', () => {
        const panel = card.closest('.panel');
        card.remove();
        if(panel) autoSizePanel(panel);
      });
      title.appendChild(remove);

      const grid = document.createElement('div');
      grid.className = 'course-grid';
      const fields = [
        {label:'Course Name',   key:'name',    ph:'e.g., Data Structures'},
        {label:'Course Code',   key:'code',    ph:'e.g., CSE-220'},
        {label:'Time',          key:'time',    ph:'e.g., 10:00–11:30'},
        {label:'Room Number',   key:'room',    ph:'e.g., 402'},
        {label:'Section',       key:'section', ph:'e.g., A1'},
        {label:'Faculty Name',  key:'faculty', ph:'e.g., Dr. Rahman'},
      ];
      for(const f of fields){
        const wrap = document.createElement('div');
        wrap.className = 'field';
        wrap.innerHTML = `
          <label>${f.label}</label>
          <input type="text" data-field="${f.key}" placeholder="${f.ph}" />
        `;
        grid.appendChild(wrap);
      }

      card.append(title, grid);
      return card;
    }

    // Build all day sections into DOM
    function initDays(){
      const frag = document.createDocumentFragment();
      DAYS.forEach(day => frag.appendChild(buildDaySection(day)));
      daysContainer.appendChild(frag);
    }

    // Collect data from UI
    function collectRoutineData(){
      const sections = [...document.querySelectorAll('.day-section')];
      const result = [];
      sections.forEach(sec => {
        const day = sec.dataset.day;
        const off = sec.querySelector('.offday-input').checked;
        const cards = [...sec.querySelectorAll('.course-card')];
        const courses = cards.map(c => {
          const get = key => c.querySelector(`input[data-field="${key}"]`)?.value?.trim() || '';
          return {
            name: get('name'),
            code: get('code'),
            time: get('time'),
            room: get('room'),
            section: get('section'),
            faculty: get('faculty')
          };
        }).filter(obj => Object.values(obj).some(v => v)); // keep if at least one field filled
        result.push({ day, off, courses });
      });
      return result;
    }

    // Build routine table
    function buildRoutineTable(data){
      const table = document.createElement('table');

      const thead = document.createElement('thead');
      const thr = document.createElement('tr');
      ['Day','Course Name','Course Code','Time','Room','Section','Faculty Name'].forEach(h => {
        const th = document.createElement('th'); th.textContent = h; thr.appendChild(th);
      });
      thead.appendChild(thr);

      const tbody = document.createElement('tbody');

      data.forEach(entry => {
        if(entry.off){
          const tr = document.createElement('tr');
          const tdDay = document.createElement('td');
          tdDay.textContent = entry.day;
          tdDay.className = 'day-cell';
          const tdOff = document.createElement('td');
          tdOff.className = 'offday';
          tdOff.colSpan = 6;
          tdOff.textContent = 'Off Day';
          tr.append(tdDay, tdOff);
          tbody.appendChild(tr);
          return;
        }
        if(entry.courses.length === 0){
          const tr = document.createElement('tr');
          const tdDay = document.createElement('td');
          tdDay.textContent = entry.day;
          tdDay.className = 'day-cell';
          const tdEmpty = document.createElement('td');
          tdEmpty.className = 'empty';
          tdEmpty.colSpan = 6;
          tdEmpty.textContent = 'No courses added';
          tr.append(tdDay, tdEmpty);
          tbody.appendChild(tr);
          return;
        }
        entry.courses.forEach((c, i) => {
          const tr = document.createElement('tr');
          if(i === 0){
            const tdDay = document.createElement('td');
            tdDay.textContent = entry.day;
            tdDay.className = 'day-cell';
            tdDay.rowSpan = entry.courses.length;
            tr.appendChild(tdDay);
          }
          const cells = [c.name, c.code, c.time, c.room, c.section, c.faculty];
          cells.forEach(val => {
            const td = document.createElement('td');
            td.textContent = val || '—';
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
      });

      table.append(thead, tbody);
      return table;
    }

    // Progress animation
    function runProgress(duration = 1200){
      progressWrap.hidden = false;
      progressBar.style.width = '0%';
      return new Promise(resolve => {
        const start = performance.now();
        function frame(now){
          const p = Math.min(1, (now - start)/duration);
          progressBar.style.width = (p*100).toFixed(2) + '%';
          if(p < 1) requestAnimationFrame(frame);
          else resolve();
        }
        requestAnimationFrame(frame);
      });
    }

    // Make routine handler
    async function handleMake(){
      pdfBtn.disabled = true;
      statusMsg.hidden = true;

      const data = collectRoutineData();
      routineTableWrap.innerHTML = '';
      const table = buildRoutineTable(data);
      routineTableWrap.appendChild(table);

      // Info
      const dt = new Date();
      generatedInfo.textContent = `Generated on ${dt.toLocaleString()}`;

      // "Loading" progress
      await runProgress(1200);

      // Show success + output
      progressWrap.hidden = true;
      statusMsg.hidden = false;
      routineOutput.hidden = false;
      pdfBtn.disabled = false;

      routineOutput.scrollIntoView({behavior:'smooth', block:'start'});
    }

    function handleReset(){
      document.querySelectorAll('.day-section').forEach(sec => {
        const off = sec.querySelector('.offday-input');
        off.checked = false;
        const courses = sec.querySelector('.courses');
        courses.innerHTML = '';
        courses.style.display = 'grid';
        const offNote = sec.querySelector('.offday-note');
        offNote.hidden = true;
        const addBtn = sec.querySelector('.add-course');
        addBtn.disabled = false;
        // close accordion
        const btn = sec.querySelector('.accordion-btn');
        const panel = sec.querySelector('.panel');
        btn.setAttribute('aria-expanded','false');
        panel.style.maxHeight = '0px';
      });
      // Clear outputs
      routineTableWrap.innerHTML = '';
      routineOutput.hidden = true;
      statusMsg.hidden = true;
      progressWrap.hidden = true;
      progressBar.style.width = '0%';
      pdfBtn.disabled = true;
      generatedInfo.textContent = '';
      window.scrollTo({top:0, behavior:'smooth'});
    }

    // Ensure html2pdf is loaded (with fallback if CDN blocked)
    function ensureHtml2PdfLoaded(){
      return new Promise((resolve, reject) => {
        if (window.html2pdf) return resolve();
        const s = document.createElement('script');
        s.src = 'https://unpkg.com/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js';
        s.onload = () => resolve();
        s.onerror = () => reject(new Error('Failed to load html2pdf.js'));
        document.head.appendChild(s);
      });
    }

    // Download PDF (uses on-page element + temporary PDF-friendly CSS)
    async function handlePdf(){
      if (routineOutput.hidden) {
        alert('Please click "Make Routine" first.');
        return;
      }
      try{
        pdfBtn.disabled = true;
        const originalText = pdfBtn.textContent;
        pdfBtn.textContent = '⏳ Generating...';

        await ensureHtml2PdfLoaded();

        // Make table export-friendly
        routineOutput.classList.add('for-pdf');

        // Give the browser a tick to apply CSS changes (helps Safari)
        await new Promise(r => setTimeout(r, 50));

        const ts = new Date();
        const filename = `class-routine_${ts.getFullYear()}-${String(ts.getMonth()+1).padStart(2,'0')}-${String(ts.getDate()).padStart(2,'0')}_${String(ts.getHours()).padStart(2,'0')}${String(ts.getMinutes()).padStart(2,'0')}.pdf`;

        const opt = {
          margin: 10,
          filename,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: {
            scale: 2,
            useCORS: true,
            windowWidth: routineOutput.scrollWidth
          },
          pagebreak: { mode: ['avoid-all', 'css', 'legacy'] },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        await html2pdf().set(opt).from(routineOutput).save();
        pdfBtn.textContent = originalText;
      }catch(err){
        console.error(err);
        alert('PDF generation failed. Please check your internet (for the PDF library) or try again.\n\nDetails: ' + (err?.message || err));
      }finally{
        routineOutput.classList.remove('for-pdf');
        pdfBtn.disabled = false;
      }
    }

    // Init
    function initDays(){
      const frag = document.createDocumentFragment();
      DAYS.forEach(day => frag.appendChild(buildDaySection(day)));
      daysContainer.appendChild(frag);
    }

    initDays();
    makeBtn.addEventListener('click', handleMake);
    resetBtn.addEventListener('click', handleReset);
    pdfBtn.addEventListener('click', handlePdf);
  </script>
</body>
</html>
